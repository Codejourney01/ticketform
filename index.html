<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&display=swap" rel="stylesheet">

  <title>Conference ticket generator</title>
  <link rel="stylesheet" href="style.css">
  <!-- Feel free to remove these styles or customise in your own stylesheet ðŸ‘ -->
  <style>
    .attribution {
      font-size: 11px;
      text-align: center;
    }

    .attribution a {
      color: hsl(228, 45%, 44%);
    }
  </style>
</head>

<body>
  <div class="main">
    <div class="line"></div>

    <div class="text-box flex">
      <img class="logo" src="logo-full.svg" alt="">
      <div id="heading" class="title font flex">
        Your Journey to Coding Conf
        2025 Starts Here !
      </div>

      <p id="subheading" class="sub-title font">
        secure your spot at next year's biggest coding conference
      </p>
      <span id="error" style="display: none;font-size: 14px; color: rgb(188, 53, 53); margin-top: 20px;"
        class="font">Please fill all the fields</span>
      <div id="afterbox">
        <div class="image">
        <img class="after-box" src="pattern-ticket.svg" alt="">
          <img class="ticketlogo" src="logo-full.svg" alt="">

          <span id ="date"class="date font"></span>
          <span class="font" id="code"></span>
          <div class="ticket-info">
            
          </div>
        </div>
      </div>
      <div id="textbox" class="form-fields">
        <form id="form" action="">
          <span class="form-title font">Upload Avatar</span>

          <div class="file-area flex">
            <img src="icon-upload.svg" alt="">
            <p class="font">Drag and Drop or Click to Upload</p>
            <input type="file" id="fileElem" multiple hidden accept="image/*">

          </div>
          <div class="infop" style="margin-bottom: 10px;">
            <img src="icon-info.svg" alt="">
            <span class="font">Upload your Photo (JPG or PNG max-size:500kb)</span>
          </div>
          <span class="form-title font">Full Name</span>

          <div style="margin-top: 10px;margin-bottom: 10px;">
            <input id="namec" class="name" type="text">
          </div>
          <span class="form-title font">Email Address</span>
          <div style="margin-top: 10px;margin-bottom: 10px;">
            <input id="mail" class="name" type="email" placeholder=" example@email.com">
            <span class="font" id="emailerror"
              style="display: none;font-size: 14px; color: rgb(188, 53, 53); margin-top: 20px;">invalid Email</span>
          </div>
          <span class="form-title font">Github Username</span>
          <div style="margin-top: 10px;margin-bottom: 10px;">
            <input id="git" class="name" type="text" placeholder=" @yourusername">
            <span class="font" id="giterror"
              style="display: none;font-size: 14px; color: rgb(188, 53, 53); margin-top: 20px;">Please Start with
              @</span>

          </div>

          <input onclick="generate()" type="button" value="Generate My Ticket" class="btn font">
        </form>
      </div>
    </div>
  </div>


  <script>
    let cname = document.getElementById("namec");
    let showerror = document.getElementById("error");
    let inputverify = document.querySelectorAll(".name");
    let formdata = document.getElementById("form");
    let emailverify = document.getElementById("mail");
    let gitverify = document.getElementById("git");
    let character="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";

    const fileArea = document.querySelector(".file-area");
    const fileInput = document.getElementById("fileElem");
    const filePreview = fileArea.querySelector("img"); // existing img inside file-area

    function generateRandomCode(length = 5) {
  let result = "";
  for (let i = 0; i < length; i++) {
    const randomIndex = Math.floor(Math.random() * character.length);
    result += character[randomIndex];
  }
  return result;
}

const randomCode = generateRandomCode();
    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileArea.addEventListener(eventName, e => e.preventDefault());
    });

    // Highlight on dragover
    ['dragenter', 'dragover'].forEach(eventName => {
      fileArea.addEventListener(eventName, () => fileArea.classList.add('highlight'));
    });

    // Remove highlight on dragleave / drop
    ['dragleave', 'drop'].forEach(eventName => {
      fileArea.addEventListener(eventName, () => fileArea.classList.remove('highlight'));
    });

    // Handle dropped files
    fileArea.addEventListener('drop', e => {
      const files = e.dataTransfer.files;
      handleFiles(files);
    });

    // Handle click to upload
    fileArea.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', () => handleFiles(fileInput.files));

    // Function to preview image
    function handleFiles(files) {
      if (files.length === 0) return;
      const file = files[0];

      if (!file.type.startsWith('image/')) {
        alert("Only image files are allowed");
        return;
      }

      if (file.size > 500 * 1024) { // 500kb
        alert("File size exceeds 500KB");
        return;
      }

      const reader = new FileReader();
      reader.onload = e => {
        filePreview.src = e.target.result; // change the img src
      };
      reader.readAsDataURL(file);
    }
  

    // Form validation and ticket generation
    function generate() {

      const d = new Date();
      const formattedDate = `${String(d.getDate()).padStart(2,'0')}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getFullYear()).slice(-2)}`;
      let fname = cname.value;
      let git = gitverify.value;
      let email = emailverify.value;
      const valid = /[^a-zA-Z0-9@.]/.test(email);
      let status = false;

      for (let input of inputverify) {
        if (!input.value.trim()) {
          status = true;
          break;
        }
      }

      if (valid) {
        document.getElementById("emailerror").style.display = "block";
      } else {
        document.getElementById("emailerror").style.display = "none";
      }

      if (git.startsWith("@")) {
        document.getElementById("giterror").style.display = "none";
      } else {
        document.getElementById("giterror").style.display = "block";
      }

      if (status) {
        showerror.style.display = "block";
      } else {
        document.getElementById("subheading").style.fontSize="10px";
        document.getElementById("subheading").style.width="240px";
        document.getElementById("code").innerHTML="# " + randomCode;
        document.getElementById("heading").style.fontSize = "24px"
        document.getElementById("subheading").innerHTML = "We have emailed your ticket to " + email + " and will send updates in the run up to the event"
        document.getElementById("afterbox").style.display = "block"
        document.getElementById("heading").innerText = "Congrats," + fname + " Your ticket is ready";
        document.getElementById("textbox").style.display = "none";
        document.getElementById("date").innerHTML=formattedDate;

      }
    }
  </script>

</body>

</html>